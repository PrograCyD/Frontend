<div class="explore-container">
  <!-- Header -->
  <header class="explore-header">
    <h1 class="page-title">Explorar películas</h1>
    <p class="page-description">
      Descubre y busca entre todas las películas disponibles
    </p>
  </header>

  <!-- Search and Filter Bar -->
  <div class="search-filter-section">
    <div class="search-filter-bar">
      <!-- Search Input -->
      <div class="search-input-wrapper">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input
          type="text"
          placeholder="Buscar películas por título..."
          [value]="searchQuery()"
          (input)="onSearchChange($event)"
          class="search-input"
        />
      </div>

      <!-- Filter Button -->
      <button
        (click)="toggleFilters()"
        [class.active]="showFilters()"
        class="filter-button"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
        </svg>
        <span>Filtros</span>
        @if (activeFiltersCount() > 0) {
          <span class="filter-badge">{{ activeFiltersCount() }}</span>
        }
      </button>
    </div>

    <!-- Active Filters Display -->
    @if (activeFiltersCount() > 0) {
      <div class="active-filters">
        <span class="active-filters-label">Filtros activos:</span>

        @if (selectedGenre()) {
          <span class="filter-chip genre-chip">
            <span>{{ selectedGenre() }}</span>
            <button (click)="clearGenre()" class="remove-chip">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </span>
        }

        @if (yearFrom() || yearTo()) {
          <span class="filter-chip year-chip">
            <span>
              Año:
              {{ yearFrom() || '…' }} - {{ yearTo() || '…' }}
            </span>
            <button (click)="clearYears()" class="remove-chip">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </span>
        }

        <button (click)="clearAllFilters()" class="clear-filters-button">
          Limpiar todo
        </button>
      </div>
    }

    <!-- Filter Panel (solo lo que soporta el endpoint) -->
    @if (showFilters()) {
      <div class="filter-panel">
        <div class="filter-columns">
          <!-- Genre Filter -->
          <div class="filter-column">
            <label class="filter-input-label">
              <span class="material-icons">category</span>
              Género
            </label>
            <select
              class="filter-select"
              [value]="selectedGenre() || ''"
              (change)="onGenreChange($event)"
            >
              <option value="">Todos</option>
              @for (genre of allGenres(); track genre) {
                <option [value]="genre">{{ genre }}</option>
              }
            </select>
          </div>
        </div>

        <div class="additional-filters">
          <!-- Year From -->
          <div class="filter-input-group">
            <label class="filter-input-label">
              <span class="material-icons">calendar_today</span>
              Año Desde
            </label>
            <input
              type="number"
              [value]="yearFrom() || ''"
              (input)="onYearFromChange($event)"
              placeholder="Ej: 2000"
              min="1900"
              max="2100"
              class="filter-number-input"
            />
          </div>

          <!-- Year To -->
          <div class="filter-input-group">
            <label class="filter-input-label">
              <span class="material-icons">event</span>
              Año Hasta
            </label>
            <input
              type="number"
              [value]="yearTo() || ''"
              (input)="onYearToChange($event)"
              placeholder="Ej: 2024"
              min="1900"
              max="2100"
              class="filter-number-input"
            />
          </div>
        </div>
      </div>
    }
  </div>

  <!-- Results Count -->
  <div class="results-info">
    <p class="results-count">
      @if (totalMovies() > 0) {
        Mostrando {{ movies().length }} de {{ totalMovies() }} películas
        (página {{ currentPage() }} de {{ totalPages() }})
      } @else {
        Mostrando {{ movies().length }} películas
        (página {{ currentPage() }})
      }
    </p>
  </div>

  <!-- Movies Grid + Paginación -->
  @if (movies().length > 0) {
    <div class="movies-grid">
      @for (movie of movies(); track movie.movieId) {
        <app-movie-card
          [movie]="movie"
          (movieClick)="onMovieClick(movie)">
        </app-movie-card>
      }
    </div>

    <div class="pagination">
      <button (click)="prevPage()" [disabled]="currentPage() === 1">
        « Anterior
      </button>

      <!-- Solo mostramos numeritos si el backend nos da un total confiable -->
      @if (totalMovies() > 0) {
        @for (page of visiblePages(); track page) {
          <button
            (click)="goToPage(page)"
            [class.active]="page === currentPage()">
            {{ page }}
          </button>
        }
      }

      <button
        (click)="nextPage()"
        [disabled]="!hasNextPage()">
        Siguiente »
      </button>
    </div>
  } @else {
    <div class="empty-state">
      <!-- tu empty state original -->
      <svg class="empty-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
        <line x1="11" y1="8" x2="11" y2="14"></line>
        <line x1="8" y1="11" x2="14" y2="11"></line>
      </svg>
      <p class="empty-title">No se encontraron películas</p>
      <p class="empty-description">Intenta ajustar tus filtros de búsqueda</p>
    </div>
  }
</div>
