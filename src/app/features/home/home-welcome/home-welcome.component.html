<!-- Hero Section con Película Destacada -->
@if (featuredMovie(); as featured) {
  <section class="hero-section" [style.backgroundImage]="'url(' + featured.backdropPath + ')'">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <div class="hero-info">
        <h1 class="hero-title">{{ featured.title }}</h1>
        <div class="hero-metadata">
          @if (featured.voteAverage) {
            <span class="hero-rating">
              <span class="material-icons">star</span>
              {{ featured.voteAverage.toFixed(1) }}
            </span>
          }
          @if (featured.releaseDate) {
            <span class="hero-year">{{ getYear(featured.releaseDate) }}</span>
          }
          @if (featured.runtime) {
            <span class="hero-runtime">{{ featured.runtime }} min</span>
          }
        </div>
        <p class="hero-overview">{{ featured.overview }}</p>
        <div class="hero-genres">
          @for (genre of featured.genres; track genre) {
            <span class="genre-badge">{{ genre }}</span>
          }
        </div>

        <!-- Nueva sección de calificación en el hero -->
        <div class="hero-rating-section">
          <span class="rating-label">Califica esta película:</span>
          <app-star-rating
            [rating]="heroRating()"
            [readonly]="false"
            [size]="'lg'"
            (ratingChange)="onHeroRatingChange($event)">
          </app-star-rating>
        </div>

        <div class="hero-actions">
          <button class="btn btn-primary" (click)="viewFeaturedMovieDetails()">
            <span class="material-icons">info</span>
            Ver Detalles
          </button>
        </div>
      </div>
    </div>
  </section>
}

<!-- Top 10 Películas Mejor Rankeadas -->
<section class="section">
  <div class="section-header">
    <h2 class="section-title">Top 10 Películas Mejor Rankeadas</h2>
  </div>
  <button class="carousel-nav-button prev" (click)="scrollCarousel('top', 'left')" #topPrev>
    <span class="material-icons">chevron_left</span>
  </button>
  <div class="top-movies-carousel" #topCarousel>
    @for (movie of topMovies(); track movie.movieId; let idx = $index) {
      <div class="top-movie-wrapper">
        <app-top-movie-card
          [movie]="movie"
          [rank]="idx + 1"
          (movieClick)="onMovieClick(movie)"
          (ratingChange)="onTopMovieRatingChange($event)">
        </app-top-movie-card>
      </div>
    }
  </div>
  <button class="carousel-nav-button next" (click)="scrollCarousel('top', 'right')" #topNext>
    <span class="material-icons">chevron_right</span>
  </button>
</section>

<!-- Top 10 Películas Más Populares -->
<section class="section">
  <div class="section-header">
    <h2 class="section-title">Top 10 Películas Más Populares</h2>
  </div>
  <button class="carousel-nav-button prev" (click)="scrollCarousel('popular', 'left')" #popularPrev>
    <span class="material-icons">chevron_left</span>
  </button>
  <div class="top-movies-carousel" #popularCarousel>
    @for (movie of popularMovies(); track movie.movieId; let idx = $index) {
      <div class="top-movie-wrapper">
        <app-top-movie-card
          [movie]="movie"
          [rank]="idx + 1"
          (movieClick)="onMovieClick(movie)"
          (ratingChange)="onPopularMovieRatingChange($event)">
        </app-top-movie-card>
      </div>
    }
  </div>
  <button class="carousel-nav-button next" (click)="scrollCarousel('popular', 'right')" #popularNext>
    <span class="material-icons">chevron_right</span>
  </button>
</section>

<!-- Recomendaciones para ti -->
@if (recommendedMovies().length > 0) {
  <section class="section">
    <div class="section-header">
      <h2 class="section-title">Recomendaciones para ti</h2>
      <a routerLink="/recommendations" class="section-link">Ver más</a>
    </div>
    <button class="carousel-nav-button prev" (click)="scrollCarousel('recommended', 'left')" #recommendedPrev>
      <span class="material-icons">chevron_left</span>
    </button>
    <div class="movies-carousel" #recommendedCarousel>
      @for (movie of recommendedMovies(); track movie.movieId) {
        <app-movie-card
          [movie]="movie"
          (movieClick)="onMovieClick(movie)"
          (ratingChange)="onMovieRatingChange($event)">
        </app-movie-card>
      }
    </div>
    <button class="carousel-nav-button next" (click)="scrollCarousel('recommended', 'right')" #recommendedNext>
      <span class="material-icons">chevron_right</span>
    </button>
  </section>
}

<!-- Recomendaciones por géneros favoritos -->
@if (genreRecommendations().length > 0) {
  <section class="section">
    <div class="section-header">
      <h2 class="section-title">Porque te gusta Acción</h2>
      <a routerLink="/movies" [queryParams]="{genre: 'Acción'}" class="section-link">Ver más</a>
    </div>
    <button class="carousel-nav-button prev" (click)="scrollCarousel('genre', 'left')" #genrePrev>
      <span class="material-icons">chevron_left</span>
    </button>
    <div class="movies-carousel" #genreCarousel>
      @for (movie of genreRecommendations(); track movie.movieId) {
        <app-movie-card
          [movie]="movie"
          (movieClick)="onMovieClick(movie)"
          (ratingChange)="onMovieRatingChange($event)">
        </app-movie-card>
      }
    </div>
    <button class="carousel-nav-button next" (click)="scrollCarousel('genre', 'right')" #genreNext>
      <span class="material-icons">chevron_right</span>
    </button>
  </section>
}

<!-- Porque te gustó [tag] -->
@if (becauseYouLikedMovies().length > 0) {
  <section class="section">
    <div class="section-header">
      <h2 class="section-title">Porque te gustó "must watch"</h2>
    </div>
    <button class="carousel-nav-button prev" (click)="scrollCarousel('liked', 'left')" #likedPrev>
      <span class="material-icons">chevron_left</span>
    </button>
    <div class="movies-carousel" #likedCarousel>
      @for (movie of becauseYouLikedMovies(); track movie.movieId) {
        <app-movie-card
          [movie]="movie"
          (movieClick)="onMovieClick(movie)"
          (ratingChange)="onMovieRatingChange($event)">
        </app-movie-card>
      }
    </div>
    <button class="carousel-nav-button next" (click)="scrollCarousel('liked', 'right')" #likedNext>
      <span class="material-icons">chevron_right</span>
    </button>
  </section>
}


